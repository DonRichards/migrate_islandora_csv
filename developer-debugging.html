<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Developer Debugging - Next Generation Digital Repository Solution</title><meta name="description" content="There are 2 options for debugging; core debugger and the Migration Devel Full tutorial How to Print Variables using Kint in Drupal 8 $ chmod&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://donrichards.github.io/migrate_islandora_csv/developer-debugging.html"><link rel="amphtml" href="https://donrichards.github.io/migrate_islandora_csv/amp/developer-debugging.html"><link rel="alternate" type="application/atom+xml" href="https://donrichards.github.io/migrate_islandora_csv/feed.xml"><link rel="alternate" type="application/json" href="https://donrichards.github.io/migrate_islandora_csv/feed.json"><meta property="og:title" content="Developer Debugging"><meta property="og:site_name" content="Next Generation Digital Repository Solution"><meta property="og:description" content="There are 2 options for debugging; core debugger and the Migration Devel Full tutorial How to Print Variables using Kint in Drupal 8 $ chmod&hellip;"><meta property="og:url" content="https://donrichards.github.io/migrate_islandora_csv/developer-debugging.html"><meta property="og:type" content="article"><link rel="shortcut icon" href="https://donrichards.github.io/migrate_islandora_csv/media/website/add.ico" type="image/x-icon"><link rel="stylesheet" href="https://donrichards.github.io/migrate_islandora_csv/assets/css/style.css?v=16a64c46666bea60947fd47410df672e"><link rel="stylesheet" href="https://donrichards.github.io/migrate_islandora_csv/assets/css/prism-default.css?v=9744853d64d710edcae61a3d59a17ee2"><link rel="stylesheet" href="https://donrichards.github.io/migrate_islandora_csv/assets/css/docsearch.css?v=0407a7a131feaf753e76cd9d86149dc2"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://donrichards.github.io/migrate_islandora_csv/developer-debugging.html"},"headline":"Developer Debugging","datePublished":"2020-07-10T20:22","dateModified":"2020-07-20T15:40","description":"There are 2 options for debugging; core debugger and the Migration Devel Full tutorial How to Print Variables using Kint in Drupal 8 $ chmod&hellip;","author":{"@type":"Person","name":"Don Richards"},"publisher":{"@type":"Organization","name":"Don Richards"}}</script></head><body><header class="header" id="js-header"><a class="logo" href="https://donrichards.github.io/migrate_islandora_csv/">Next Generation Digital Repository Solution </a><a href="https://github.com/donrichards/migrate_islandora_csv/" class="btn btn--outline btn--icon github" aria-label="Github" title="Github"><svg height="22" width="22"><use xlink:href="https://donrichards.github.io/migrate_islandora_csv/assets/svg/svg-map.svg#github"></use></svg> Github</a></header><main><div class="container container--with-sidebar"><div class="sidebar js-sidebar"><form action="https://donrichards.github.io/migrate_islandora_csv/search.html" class="sidebar__search"><input type="search" placeholder="search..." aria-label="Search" id="docsearch-input" class="js-search"></form><nav class="sidebar__menu"><ul class="js-sidebar-menu"><li class="has-submenu"><a href="https://donrichards.github.io/migrate_islandora_csv/islandora-8-overview.html">Islandora</a><ul><li><a href="https://donrichards.github.io/migrate_islandora_csv/islandora-8-overview.html">Overview</a></li><li><a href="https://donrichards.github.io/migrate_islandora_csv/background.html">Background</a></li><li><a href="https://donrichards.github.io/migrate_islandora_csv/community-and-sustainability.html">Community &amp; Sustainability</a></li><li><a href="https://donrichards.github.io/migrate_islandora_csv/vendors.html">Vendors</a></li></ul></li><li class="has-submenu"><a href="https://donrichards.github.io/migrate_islandora_csv/content-modeling.html">Content Modeling</a><ul><li><a href="https://donrichards.github.io/migrate_islandora_csv/content-modeling.html">Content Model Overview</a></li><li><a href="https://donrichards.github.io/migrate_islandora_csv/general-content-models.html">General Content Modeling</a></li><li><a href="https://donrichards.github.io/migrate_islandora_csv/pcdm.html">PCDM</a></li><li><a href="https://donrichards.github.io/migrate_islandora_csv/images-books-and-pages.html">Images, Books, and Pages</a></li><li><a href="https://donrichards.github.io/migrate_islandora_csv/other-content-types.html">Other Objects</a></li><li><a href="https://donrichards.github.io/migrate_islandora_csv/book-and-large-image-viewer.html">Books &amp; Large Image Viewer</a></li></ul></li><li class="active-parent has-submenu"><a href="https://donrichards.github.io/migrate_islandora_csv/uploading-ingesting-and-migration.html">Uploading, Ingesting, and Migration</a><ul><li><a href="https://donrichards.github.io/migrate_islandora_csv/uploading-ingesting-and-migration.html">Overview</a></li><li><a href="https://donrichards.github.io/migrate_islandora_csv/uploading.html">Uploading</a></li><li><a href="https://donrichards.github.io/migrate_islandora_csv/ingestingmigrating.html">Ingesting &amp; Migrating</a></li><li class="active"><a href="https://donrichards.github.io/migrate_islandora_csv/developer-debugging.html">Developer Debugging</a></li></ul></li><li><a href="https://donrichards.github.io/migrate_islandora_csv/preservation.html">Preservation</a></li><li class="has-submenu"><a href="https://donrichards.github.io/migrate_islandora_csv/metadata-and-metadata-sharing.html">Metadata and Metadata Sharing</a><ul><li><a href="https://donrichards.github.io/migrate_islandora_csv/mods-to-rdf.html">MODS to RDF Mapping</a></li><li><a href="https://donrichards.github.io/migrate_islandora_csv/oai-pmh-and-doi-minting.html">OAI-PMH &amp; DOI Minting</a></li><li><a href="https://donrichards.github.io/migrate_islandora_csv/bibliography-and-citation.html">Bibliography &amp; Citation</a></li><li><a href="https://donrichards.github.io/migrate_islandora_csv/rights-and-restrictions.html">Rights &amp; Restrictions</a></li><li><a href="https://donrichards.github.io/migrate_islandora_csv/next-level-discoverability-solutions.html">Next Level Discoverability Solutions</a></li></ul></li><li class="has-submenu"><a href="https://donrichards.github.io/migrate_islandora_csv/technical-infrastructure.html">Technical Infrastructure</a><ul><li><a href="https://donrichards.github.io/migrate_islandora_csv/technical-infrastructure.html">Technical Infrastructure</a></li><li><a href="https://donrichards.github.io/migrate_islandora_csv/how-to-access-specific-data.html">How to access specific data</a></li></ul></li><li class="has-submenu"><a href="https://donrichards.github.io/migrate_islandora_csv/deployment-options.html">Deployment Options</a><ul><li><a href="https://donrichards.github.io/migrate_islandora_csv/cloud-hosting-solution.html">Cloud Hosting</a></li><li><a href="https://donrichards.github.io/migrate_islandora_csv/cas-authentication.html">CAS</a></li></ul></li><li class="has-submenu"><a href="https://donrichards.github.io/migrate_islandora_csv/institutional-repository.html">Institutional Repository</a><ul><li><a href="https://donrichards.github.io/migrate_islandora_csv/bibliography-and-citation.html">Bibliography &amp; Citation</a></li><li><a href="https://donrichards.github.io/migrate_islandora_csv/step-by-step-setup-ir.html">Step by Step Setup (IR)</a></li></ul></li><li class="active-parent red has-submenu"><a href="https://donrichards.github.io/migrate_islandora_csv/quick-document-design-key.html">PDF&#x27;s Quick Reference Material Locations</a><ul><li class="active red"><a href="https://donrichards.github.io/migrate_islandora_csv/developer-debugging.html">Developer Debugging</a></li></ul></li></ul></nav></div><div class="content content--center"><article class="post"><h1>Developer Debugging</h1><div class="post__entry"><p>There are 2 options for debugging; core debugger and the Migration Devel</p><h2 id="add-general-debugging">Add General Debugging</h2><p>Full tutorial <a href="https://www.webwash.net/how-to-print-variables-using-kint-in-drupal-8/">How to Print Variables using Kint in Drupal 8</a></p><pre><code class="language-shell">$ chmod 755 /var/www/drupal/web/sites/default
$ drush -y en devel
$ drush -y en kint

# Adding the debug service
$ cp /var/www/drupal/web/sites/default/default.services.yml /var/www/drupal/web/sites/default/services.yml
        $ Change debug value
        debug:true

# Adding the debug to the template
$ nano /var/www/drupal/web/themes/contrib/carapace/templates/generated/page.html.twig
    Add under the first comment, above the first item:    {{ kint(page) }} 
</code></pre><h2 id="install-migrate-devel">Install Migrate Devel</h2><p>This gives a lot of feedback on a migration failure.</p><pre><code class="language-shell">$ cp /var/www/drupal/
$ composer require &#39;drupal/migrate_devel:^2.0&#39;
$ drush en -y    migrate_devel</code></pre><h3 id="when-you-modify-a-migration-yml-file">When you modify a migration YML file</h3><p>This messes up me all the time. So much so I created a <a href="https://gist.github.com/DonRichards/ce71c2b18e1567a61ea8fe96b3e8ed70">script</a> I just have running in the background to force all updates after they’re written. This isn’t absolutely nessisary but I find it useful.</p><pre><code class="language-shell">$ drush -y fim migrate_islandora_csv</code></pre><h3 id="typical-migration">Typical Migration</h3><p>It’s highly suggested to migrate by group so the order of operations work in your favor. This is a typic execution of that.</p><p><em>Remember that the order of operations is important (taxonomy terms like persons and subjects should go first, files, node, and lastly media) if you haven’t previously imported them. This is a problem if the dependencies are properly specified or the <code>--execute-dependencies</code> isn’t added to the import. The <code>-d</code> is for debugging. This will add a little time to the process. And you will need to include <code>--userid=1</code> to this. I have experienced issues not using it.</em></p><pre><code class="language-shell">drush migrate:import --userid=1 --execute-dependencies --group=knoxgardens_migrate_islandora_csv -d</code></pre><h3 id="debugging-migration">Debugging Migration</h3><p>Migrate:import has a lot of options. This is the complete list. I won’t go over most of them. To read more on <a href="https://drushcommands.com/drush-8x/migrate/migrate-import/">drush migrate-import</a></p><pre><code class="language-shell">migrate:import [--all] [--group GROUP] [--tag TAG] [--limit LIMIT] [--feedback FEEDBACK] [--idlist IDLIST] [--idlist-delimiter [IDLIST-DELIMITER]] [--update] [--force] [--continue-on-failure] [--execute-dependencies] [--skip-progress-bar] [--sync] [-h|--help] [-q|--quiet] [-v|vv|vvv|--verbose] [-V|--version] [--ansi] [--no-ansi] [-n|--no-interaction] [-d|--debug] [-y|--yes] [--no] [--remote-host REMOTE-HOST] [--remote-user REMOTE-USER] [-r|--root ROOT] [-l|--uri URI] [--simulate] [--pipe] [-D|--define DEFINE] [--userid USERID] [--migrate-debug [MIGRATE-DEBUG]] [--migrate-debug-pre [MIGRATE-DEBUG-PRE]] [--druplicon] [--notify [NOTIFY]] [--xh-link XH-LINK] [--] &lt;command&gt; [&lt;migration_names&gt;]</code></pre><p>Migration test are done one migration yml at a time by specifying the migration ID. To get a list of installed migrations with the status and group name(s) run migrate status:</p><pre><code class="language-shell">$ drush migrate:status
 &quot;-----------------------------------------------------------------------------------&quot;
  Group         Migration ID   Status Total  Imported  Unprocessed   Last Imported
  ----------------------------    ------------   ----  ------  -----  --  -----------
  pcard00_migrate_islandora_csv   pcard00_file   Idle   4224   6989   0   2020-07-10
  pcard00_migrate_islandora_csv   pcard00_node   Idle   4224   6991   0   2020-07-10
  pcard00_migrate_islandora_csv   pcard00_media  Idle   4224   6990   0   2020-07-10
 &quot;-----------------------------------------------------------------------------------&quot;</code></pre><p>To only run against a specific object. Within each of the yml files a <strong>key</strong> is specified. The <strong>key</strong> is saying for each unique one of these iterate through. If the the <strong>key</strong> is to to <code>key: PID</code> and the PID we want to migrate/update is <em>islandora:4223</em> we can the following command. Using a value with special characters gives me some concern so I suggest just adding sequential numbers as the first colunm in the CSV calling it <strong>ID</strong> to avoid possible issues. I have not personally tested using a PID as the key but I’m using it here to illustrate.</p><pre><code class="language-shell">#         id of the yml file   ┐                 ┌ Respect the order of operations
$ drush migrate:import pcard00_node --execute-dependencies --migrate-debug --idlist=&quot;islandora:4223&quot; --userid=1</code></pre><p>This outputs a <strong>Source</strong> and a <strong>Destination</strong> variables to see how they are mapping. The <strong>Source</strong> is good to see if the values are being read. This is the <strong>Destination</strong> part of the report.</p><pre><code class="language-shell">...
...
^ &quot;---------------------------------------------------------------------&quot;
^ &quot;|                           $Destination                            |&quot;
^ &quot;---------------------------------------------------------------------&quot;
^ array:8 [
  &quot;circuit_breaker&quot; =&gt; &quot;Page&quot;
  &quot;name&quot; =&gt; &quot;Night View of Gatlinburg, Tennessee Showing Mount LeConte in the Background (GS-262)&quot;
  &quot;uid&quot; =&gt; 1
  &quot;field_media_use&quot; =&gt; &quot;17&quot;
  &quot;field_media_file&quot; =&gt; &quot;3074&quot;
  &quot;field_pid&quot; =&gt; &quot;pcard00:108573&quot;
  &quot;field_media_of&quot; =&gt; &quot;7095&quot;
  &quot;bundle&quot; =&gt; &quot;image&quot;
]
^ &quot;---------------------------------------------------------------------&quot;
^ &quot;|                       $DestinationIdValues                        |&quot;
^ &quot;---------------------------------------------------------------------&quot;</code></pre><h2 id="rolling-back">Rolling back</h2><p>This process has a small flaw. The original file is left in the Bigdata log and fills up the VM very quickly. It will eventually remove itself but I haven’t found a simple way to trigger a cron to clear it. The process can be done quickly but there is probably a fast way than I have been doing it. I suggest only rolling back when you have extra files or to remove remove the content entirely. If you plan on just updating, just use the <code>--update</code> switch.</p><pre><code class="language-shell">$ drush migrate:rollback --userid=1 --group=knoxgardens_migrate_islandora_csv -d
# VS
$ drush migrate:import --userid=1 --group=knoxgardens_migrate_islandora_csv -d --update</code></pre><h2 id="caches">Caches</h2><pre><code class="language-shell"># Clear Drupal cache
$ drush cr

# Karaf Cache
rm -rf /opt/karaf/data/cache/

# Migration cache. The migration caches .yml files. If you already ran a migration and updated or added .yml files, you need to rebuild the Drupal 8 cache. Otherwise, Drupal will ignore the changes in the file system.

$ drush sql:query &quot;TRUNCATE druid_mods_file_migration_settings&quot;</code></pre><h2 id="extra">Extra</h2><pre><code class="language-shell">#  after running `make` pull all of the latest docker images
$ docker images | grep -v REPOSITORY | awk &#39;{print $1}&#39; | xargs -L1 docker pull </code></pre><p>Deleting a migration (rare but it happens). If you’ve previously created a file like <em>druid_mods_file_migration.yml</em> and ran it. That configuration was imported into Drupal’s config. Deleting the module file will not remove it from Drupal’s config. You either need to overwrite it or delete it all together.</p><pre><code class="language-shell">$ drush config:delete your-migration-file-name-without-extension

# example
$ drush config:delete druid_mods_file_migration</code></pre><h2 id="notes">NOTES</h2><p>Althought there are really straight forward migration tutorials like <a href="https://understanddrupal.com/articles/tips-writing-drupal-migrations-and-understanding-their-workflow">this</a> one. All of the migration content on this and previous pages have been done without leveraging the more powerful part of a Drupal migration, custom PHP code to handle advanced beahviors. Here is an <a href="https://agaric.coop/blog/adding-extra-source-properties-drupal-migrations">example</a> of how to do this.</p><footer><div class="post__footer"></div><nav><ul class="post__nav"><li class="post__nav-prev">Prev: <a href="https://donrichards.github.io/migrate_islandora_csv/vendors.html" rel="prev" title="Vendors">Vendors</a></li><li class="post__nav-next">Next: <a href="https://donrichards.github.io/migrate_islandora_csv/how-to-run-on-aws.html" rel="next" title="How to run on AWS">How to run on AWS</a></li></ul></nav></footer></div></article></div></div></main><footer class="footer"><div><a class="footer__logo" href="https://donrichards.github.io/migrate_islandora_csv/">Next Generation Digital Repository Solution</a></div><div><div class="footer__copy">For more information <a href="https://islandora.github.io/documentation/"></a></div><div class="footer__social"></div></div></footer><script>window.publiiThemeMenuConfig = {    
        mobileMenuMode: 'sidebar',
        animationSpeed: 300,
        submenuWidth: 'auto',
        doubleClickTime: 500,
        mobileMenuExpandableSubmenus: true
   };</script><script defer="defer" src="https://donrichards.github.io/migrate_islandora_csv/assets/js/scripts.min.js?v=fe8e4c5e655cb81dbff1ee359a0b8f92"></script><script>var images = document.querySelectorAll('img[loading]');

        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script><script defer="defer" src="https://donrichards.github.io/migrate_islandora_csv/assets/js/prism.js?v=277309e26a038bf312a7e8aa239cfbd8"></script><script defer="defer" src="https://donrichards.github.io/migrate_islandora_csv/assets/js/prism-line-numbers.min.js?v=13275d3ac10d7028cf6a6f5da276f68c"></script><script defer="defer" src="https://donrichards.github.io/migrate_islandora_csv/assets/js/prism-copy-to-clipboard.min.js?v=fabfc3fd9af83cda5208ba2e9f9ed238"></script><script src="https://donrichards.github.io/migrate_islandora_csv/assets/js/docsearch.min.js?v=9db7c9eaa8e736ce16840e5bbc02047b"></script><script>docsearch({
                        apiKey: '2e185d125fc3636674585c446905cd8e',
                        indexName: 'donrichards_migrate_islandora_csv',
                        inputSelector: '#docsearch-input',
                        debug: false
                });</script><script defer="defer" src="https://donrichards.github.io/migrate_islandora_csv/assets/js/quicklink.umd.js?v=61daff262ce6be0813e6b1b0341274d4"></script><script>window.addEventListener('load', () =>{
         quicklink();
      });</script></body></html>