<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Manually Configuring Drupal 8/9 - Next Generation Digital Repository Solution</title><meta name="description" content="After all of the above pieces are in place, installed, configured, started, and otherwise prepared, the last thing we need to do is to finally&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://donrichards.github.io/migrate_islandora_csv/manually-configuring-drupal-89.html"><link rel="amphtml" href="https://donrichards.github.io/migrate_islandora_csv/amp/manually-configuring-drupal-89.html"><link rel="alternate" type="application/atom+xml" href="https://donrichards.github.io/migrate_islandora_csv/feed.xml"><link rel="alternate" type="application/json" href="https://donrichards.github.io/migrate_islandora_csv/feed.json"><meta property="og:title" content="Manually Configuring Drupal 8/9"><meta property="og:site_name" content="Next Generation Digital Repository Solution"><meta property="og:description" content="After all of the above pieces are in place, installed, configured, started, and otherwise prepared, the last thing we need to do is to finally&hellip;"><meta property="og:url" content="https://donrichards.github.io/migrate_islandora_csv/manually-configuring-drupal-89.html"><meta property="og:type" content="article"><link rel="shortcut icon" href="https://donrichards.github.io/migrate_islandora_csv/media/website/add.ico" type="image/x-icon"><link rel="stylesheet" href="https://donrichards.github.io/migrate_islandora_csv/assets/css/style.css?v=16a64c46666bea60947fd47410df672e"><link rel="stylesheet" href="https://donrichards.github.io/migrate_islandora_csv/assets/css/prism-default.css?v=9744853d64d710edcae61a3d59a17ee2"><link rel="stylesheet" href="https://donrichards.github.io/migrate_islandora_csv/assets/css/docsearch.css?v=0407a7a131feaf753e76cd9d86149dc2"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://donrichards.github.io/migrate_islandora_csv/manually-configuring-drupal-89.html"},"headline":"Manually Configuring Drupal 8/9","datePublished":"2020-07-15T14:05","dateModified":"2020-07-15T14:05","description":"After all of the above pieces are in place, installed, configured, started, and otherwise prepared, the last thing we need to do is to finally&hellip;","author":{"@type":"Person","name":"Don Richards"},"publisher":{"@type":"Organization","name":"Don Richards"}}</script></head><body><header class="header" id="js-header"><a class="logo" href="https://donrichards.github.io/migrate_islandora_csv/">Next Generation Digital Repository Solution </a><a href="https://github.com/donrichards/migrate_islandora_csv/" class="btn btn--outline btn--icon github" aria-label="Github" title="Github"><svg height="22" width="22"><use xlink:href="https://donrichards.github.io/migrate_islandora_csv/assets/svg/svg-map.svg#github"></use></svg> Github</a></header><main><div class="container container--with-sidebar"><div class="sidebar js-sidebar"><form action="https://donrichards.github.io/migrate_islandora_csv/search.html" class="sidebar__search"><input type="search" placeholder="search..." aria-label="Search" id="docsearch-input" class="js-search"></form><nav class="sidebar__menu"><ul class="js-sidebar-menu"><li class="has-submenu"><a href="https://donrichards.github.io/migrate_islandora_csv/islandora-8-overview.html">Islandora</a><ul><li><a href="https://donrichards.github.io/migrate_islandora_csv/islandora-8-overview.html">Overview</a></li><li><a href="https://donrichards.github.io/migrate_islandora_csv/background.html">Background</a></li><li><a href="https://donrichards.github.io/migrate_islandora_csv/community-and-sustainability.html">Community &amp; Sustainability</a></li><li><a href="https://donrichards.github.io/migrate_islandora_csv/vendors.html">Vendors</a></li></ul></li><li class="has-submenu"><a href="https://donrichards.github.io/migrate_islandora_csv/content-modeling.html">Content Modeling</a><ul><li><a href="https://donrichards.github.io/migrate_islandora_csv/content-modeling.html">Content Model Overview</a></li><li><a href="https://donrichards.github.io/migrate_islandora_csv/general-content-models.html">General Content Modeling</a></li><li><a href="https://donrichards.github.io/migrate_islandora_csv/pcdm.html">PCDM</a></li><li><a href="https://donrichards.github.io/migrate_islandora_csv/images-books-and-pages.html">Images, Books, and Pages</a></li><li><a href="https://donrichards.github.io/migrate_islandora_csv/other-content-types.html">Other Objects</a></li><li><a href="https://donrichards.github.io/migrate_islandora_csv/book-and-large-image-viewer.html">Books &amp; Large Image Viewer</a></li></ul></li><li class="has-submenu"><a href="https://donrichards.github.io/migrate_islandora_csv/uploading-ingesting-and-migration.html">Uploading, Ingesting, and Migration</a><ul><li><a href="https://donrichards.github.io/migrate_islandora_csv/uploading-ingesting-and-migration.html">Overview</a></li><li><a href="https://donrichards.github.io/migrate_islandora_csv/uploading.html">Uploading</a></li><li><a href="https://donrichards.github.io/migrate_islandora_csv/ingestingmigrating.html">Ingesting &amp; Migrating</a></li><li><a href="https://donrichards.github.io/migrate_islandora_csv/developer-debugging.html">Developer Debugging</a></li></ul></li><li><a href="https://donrichards.github.io/migrate_islandora_csv/preservation.html">Preservation</a></li><li class="has-submenu"><a href="https://donrichards.github.io/migrate_islandora_csv/metadata-and-metadata-sharing.html">Metadata and Metadata Sharing</a><ul><li><a href="https://donrichards.github.io/migrate_islandora_csv/mods-to-rdf.html">MODS to RDF Mapping</a></li><li><a href="https://donrichards.github.io/migrate_islandora_csv/oai-pmh-and-doi-minting.html">OAI-PMH &amp; DOI Minting</a></li><li><a href="https://donrichards.github.io/migrate_islandora_csv/bibliography-and-citation.html">Bibliography &amp; Citation</a></li><li><a href="https://donrichards.github.io/migrate_islandora_csv/rights-and-restrictions.html">Rights &amp; Restrictions</a></li><li><a href="https://donrichards.github.io/migrate_islandora_csv/next-level-discoverability-solutions.html">Next Level Discoverability Solutions</a></li></ul></li><li class="has-submenu"><a href="https://donrichards.github.io/migrate_islandora_csv/technical-infrastructure.html">Technical Infrastructure</a><ul><li><a href="https://donrichards.github.io/migrate_islandora_csv/technical-infrastructure.html">Technical Infrastructure</a></li><li><a href="https://donrichards.github.io/migrate_islandora_csv/how-to-access-specific-data.html">How to access specific data</a></li></ul></li><li class="has-submenu"><a href="https://donrichards.github.io/migrate_islandora_csv/deployment-options.html">Deployment Options</a><ul><li><a href="https://donrichards.github.io/migrate_islandora_csv/cloud-hosting-solution.html">Cloud Hosting</a></li><li><a href="https://donrichards.github.io/migrate_islandora_csv/cas-authentication.html">CAS</a></li></ul></li><li class="has-submenu"><a href="https://donrichards.github.io/migrate_islandora_csv/institutional-repository.html">Institutional Repository</a><ul><li><a href="https://donrichards.github.io/migrate_islandora_csv/bibliography-and-citation.html">Bibliography &amp; Citation</a></li><li><a href="https://donrichards.github.io/migrate_islandora_csv/step-by-step-setup-ir.html">Step by Step Setup (IR)</a></li></ul></li><li class="red has-submenu"><a href="https://donrichards.github.io/migrate_islandora_csv/quick-document-design-key.html">PDF&#x27;s Quick Reference Material Locations</a><ul><li class="red"><a href="https://donrichards.github.io/migrate_islandora_csv/developer-debugging.html">Developer Debugging</a></li></ul></li></ul></nav></div><div class="content content--center"><article class="post"><h1>Manually Configuring Drupal 8/9</h1><div class="post__entry"><p>After all of the above pieces are in place, installed, configured, started, and otherwise prepared, the last thing we need to do is to finally configure the front-end Drupal instance to wire all the installed components together.</p><h2 id="drupal-pre-configuration">Drupal Pre-Configuration</h2><h3 id="settingsphp"><code>settings.php</code></h3><p>!!! notice By default, <code>settings.php</code> is read-only for all users. It should be made writable while this pre-configuration is being done, then set back to <code>444</code> afterwards.</p><p>Some additional settings will need to be established in your default <code>settings.php</code> before Drupal-side configuration can occur.</p><p>The below configuration will establish <code>localhost</code> as a trusted host pattern, but on production sites this will need to be expanded to include the actual host patterns used by the site.</p><p><code>/opt/drupal/web/sites/default/settings.php</code></p><p><strong>Before</strong>:</p><blockquote><p>789 | ‘driver’ =&gt; ‘pgsql’,</p></blockquote><blockquote><p>790 | );</p></blockquote><p><strong>After</strong>:</p><blockquote><p>789 | ‘driver’ =&gt; ‘pgsql’,</p></blockquote><blockquote><p>790 | );</p></blockquote><blockquote><p>791 | $settings[‘trusted_host_patterns’] = [</p></blockquote><blockquote><p>792 | ‘localhost’,</p></blockquote><blockquote><p>793 | ];</p></blockquote><blockquote><p>794 | $settings[‘flysystem’] = [</p></blockquote><blockquote><p>795 | ‘fedora’ =&gt; [</p></blockquote><blockquote><p>796 | ‘driver’ =&gt; ‘fedora’,</p></blockquote><blockquote><p>797 | ‘config’ =&gt; [</p></blockquote><blockquote><p>798 | ‘root’ =&gt; ‘<a href="http://localhost:8080/fcrepo/rest/&#39;">http://localhost:8080/fcrepo/rest/&#39;</a>,</p></blockquote><blockquote><p>799 | ],</p></blockquote><blockquote><p>800 | ],</p></blockquote><blockquote><p>801 | ];</p></blockquote><p>Once this is done, refresh the cache to take hold of the new settings.</p><pre><code class="language-bash">cd /opt/drupal
drush -y cr</code></pre><h2 id="islandora">Islandora</h2><h3 id="downloading-islandora">Downloading Islandora</h3><p>The Islandora Drupal module contains the core code to create a repository ecosystem in a Drupal environment. It also includes several submodules; of importance to us is <code>islandora_core_feature</code>, which contains the key configurations that turn a Drupal site into an Islandora site.</p><p>Islandora also provides an <a href="https://github.com/Islandora/islandora_defaults"><code>islandora_defaults</code></a> module that contains additional configurations considered an appropriate launching point for configuring a site. We’re going to first enable the <code>islandora_defaults</code> module before doing any wiring on the front-end.</p><p>Take note of some of the other comments in the below bash script for an idea of what the other components are expected, and which may be considered optional.</p><pre><code class="language-bash">cd /opt/drupal
# This is a convenience piece that will help speed up most of the rest of our
# process working with Composer and Drupal.
sudo -u www-data composer require zaporylie/composer-drupal-optimizations:^1.0

# Since islandora_defaults is near the bottom of the dependency chain, requiring
# it will get most of the modules and libraries we need to deploy a standard
# Islandora site.
sudo -u www-data composer require islandora/islandora_defaults:dev-8.x-1.x

# These can be considered important or required depending on your site&#39;s
# requirements; some of them represent dependencies of Islandora submodules.
sudo -u www-data composer require drupal/pdf:1.x-dev
sudo -u www-data composer require drupal/rest_oai_pmh:^1.0
sudo -u www-data composer require drupal/facets:^1.3
sudo -u www-data composer require drupal/restui:^1.16
sudo -u www-data composer require drupal/rdfui:^1.0-beta1
sudo -u www-data composer require drupal/content_browser:^1.0@alpha

# These tend to be good to enable for a development environment, or just for a
# higher quality of life when managing Islandora. That being said, devel should
# NEVER be enabled on a production environment, as it intentionally gives the
# user tools that compromise the security of a site.
sudo -u www-data composer require drupal/console:~1.0
sudo -u www-data composer require drupal/devel:^2.0
sudo -u www-data composer require drupal/admin_toolbar:^2.0

# Islandora also provides a theme called Carapace designed to work well out of
# the box with an Islandora site.
sudo -u www-data composer require islandora/carapace:dev-8.x-3.x</code></pre><h3 id="enabling-downloaded-components">Enabling Downloaded Components</h3><p>Components we’ve now downloaded using <code>composer require</code> can be enabled simultaneously via <code>drush</code>, which will ensure they are installed in the correct dependent order. Enabling <code>islandora_defaults</code> will also ensure all content types and configurations are set up in Islandora. The installation process for all of these modules will likely take some time.</p><p>!!! notice This list of modules assumes that all of the above components were downloaded using <code>composer require</code>; if this is not the case, you may need to pare down this list manually. It also includes <code>devel</code>, which again, should not be enabled on production sites.</p><pre><code class="language-bash">cd /opt/drupal
drush -y en rdf responsive_image devel syslog serialization basic_auth rest restui search_api_solr search_api_solr_defaults facets content_browser pdf admin_toolbar islandora_defaults controlled_access_terms_defaults islandora_breadcrumbs islandora_iiif islandora_oaipmh

# If Carapace was downloaded, now is the time to enable and set it as well.
drush -y theme:enable carapace
drush -y config-set system.theme default carapace

# After all of this, rebuild the cache.
drush -y cr</code></pre><h3 id="adding-a-jwt-configuration-to-drupal">Adding a JWT Configuration to Drupal</h3><p>To allow our installation to talk to other services via Syn, we need to establish a Drupal-side JWT configuration using the keys we generated at that time.</p><p>Log onto your site as an administrator at <code>/user</code>, then navigate to <code>/admin/config/system/keys/add</code>. Some of the settings here are unimportant, but pay close attention to the <strong>Key type</strong>, which should match the key we created earlier (an RSA key), and the <strong>File location</strong>, which should be the ultimate location of the key we created for Syn on the filesystem, <code>/opt/keys/syn_private.key</code>.</p><p></p><figure class="post__image"><img loading="lazy" src="../../assets/adding_a_jwt_rsa_key.png" data-is-external-image="true" alt="Adding a JWT RSA Key"></figure><p></p><p>Click <strong>Save</strong> to create the key.</p><p>Once this key is created, navigate to <code>/admin/config/system/jwt</code> to select the key you just created from the list. Note that before the key will show up in the <strong>Private Key</strong> list, you need to select that key’s type in the <strong>Algorithm</strong> section, namely <code>RSASSA-PKCS1-v1_5 using SHA-256 (RS256)</code>.</p><p></p><figure class="post__image"><img loading="lazy" src="../../assets/configuring_the_jwt_rsa_key_for_use.png" data-is-external-image="true" alt="Configuring the JWT RSA Key for Use"></figure><p></p><p>Click <strong>Save configuration</strong> to establish this as the JWT key configuration.</p><h3 id="configuring-islandora">Configuring Islandora</h3><p>Navigate to the Islandora core configuration page at <code>/admin/config/islandora/core</code> to set up the core configuration to connect to Gemini. Of note here, the <strong>Gemini URL</strong> will need to be established to facilitate the connection to Fedora, and the appropriate <strong>Bundles with Gemini URI pseudo field</strong> types will need to be checked off.</p><p>!!! notice Any other Drupal content types you wish to synchronize with Fedora should also be checked off here.</p><p></p><figure class="post__image"><img loading="lazy" src="../../assets/configuring_islandora.png" data-is-external-image="true" alt="Configuring Islandora"></figure><p></p><h3 id="configuring-islandora-iiif">Configuring Islandora IIIF</h3><p>Navigate to <code>/admin/config/islandora/iiif</code> to ensure that Islandora IIIF is pointing to our Cantaloupe server.</p><p></p><figure class="post__image"><img loading="lazy" src="../../assets/configuring_iiif.png" data-is-external-image="true" alt="Configuring Islandora IIIF"></figure><p></p><p>Next, configure Openseadragon by navigating to <code>/admin/config/media/openseadragon</code> and ensuring everything is set up properly.</p><p></p><figure class="post__image"><img loading="lazy" src="../../assets/configuring_openseadragon.png" data-is-external-image="true" alt="Configuring Openseadragon"></figure><p></p><h3 id="establishing-flysystem-as-the-default-download-method">Establishing Flysystem as the Default Download Method</h3><p>Navigate to <code>/admin/config/media/file-system</code> to set the <strong>Default download method</strong> to the one we created in our <code>settings.php</code>.</p><p></p><figure class="post__image"><img loading="lazy" src="../../assets/configuring_flysystem_to_use_fedora.png" data-is-external-image="true" alt="Configuring Flysystem to Use Fedora"></figure><p></p><h3 id="giving-the-administrative-user-the-fedoraadmin-role">Giving the Administrative User the <code>fedoraAdmin</code> Role</h3><p>In order for data to be pushed back to Fedora, the site administrative user needs the <code>fedoraAdmin</code> role.</p><pre><code>cd /opt/drupal
sudo -u www-data drush -y urol &quot;fedoraadmin&quot; islandora</code></pre><h3 id="running-feature-migrations">Running Feature Migrations</h3><p>Finally, to get everything up and running, run the Islandora Core Features and Islandora Defaults migrations.</p><pre><code class="language-bash">cd /opt/drupal
sudo -u www-data drush -y -l localhost --userid=1 mim --group=islandora</code></pre><footer><div class="post__footer"><dl class="post__tag"><dt>Tags:</dt><dd><a href="https://donrichards.github.io/migrate_islandora_csv/component/" title="component">component</a></dd><dd><a href="https://donrichards.github.io/migrate_islandora_csv/configuration/" title="configuration">configuration</a></dd><dd><a href="https://donrichards.github.io/migrate_islandora_csv/drupal/" title="drupal">drupal</a></dd><dd><a href="https://donrichards.github.io/migrate_islandora_csv/drupal-8/" title="Drupal 8 ">Drupal 8</a></dd><dd><a href="https://donrichards.github.io/migrate_islandora_csv/fedoraadmin/" title="fedoraAdmin">fedoraAdmin</a></dd><dd><a href="https://donrichards.github.io/migrate_islandora_csv/flysystem/" title="flysystem">flysystem</a></dd><dd><a href="https://donrichards.github.io/migrate_islandora_csv/iiif/" title="IIIF">IIIF</a></dd><dd><a href="https://donrichards.github.io/migrate_islandora_csv/jwt/" title="JWT">JWT</a></dd><dd><a href="https://donrichards.github.io/migrate_islandora_csv/settings/" title="settings">settings</a></dd></dl></div><nav><ul class="post__nav"><li class="post__nav-prev">Prev: <a href="https://donrichards.github.io/migrate_islandora_csv/component-overview.html" rel="prev" title="Component Overview">Component Overview</a></li></ul></nav></footer></div></article></div></div></main><footer class="footer"><div><a class="footer__logo" href="https://donrichards.github.io/migrate_islandora_csv/">Next Generation Digital Repository Solution</a></div><div><div class="footer__copy">For more information <a href="https://islandora.github.io/documentation/"></a></div><div class="footer__social"></div></div></footer><script>window.publiiThemeMenuConfig = {    
        mobileMenuMode: 'sidebar',
        animationSpeed: 300,
        submenuWidth: 'auto',
        doubleClickTime: 500,
        mobileMenuExpandableSubmenus: true
   };</script><script defer="defer" src="https://donrichards.github.io/migrate_islandora_csv/assets/js/scripts.min.js?v=fe8e4c5e655cb81dbff1ee359a0b8f92"></script><script>var images = document.querySelectorAll('img[loading]');

        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script><script defer="defer" src="https://donrichards.github.io/migrate_islandora_csv/assets/js/prism.js?v=277309e26a038bf312a7e8aa239cfbd8"></script><script defer="defer" src="https://donrichards.github.io/migrate_islandora_csv/assets/js/prism-line-numbers.min.js?v=13275d3ac10d7028cf6a6f5da276f68c"></script><script defer="defer" src="https://donrichards.github.io/migrate_islandora_csv/assets/js/prism-copy-to-clipboard.min.js?v=fabfc3fd9af83cda5208ba2e9f9ed238"></script><script src="https://donrichards.github.io/migrate_islandora_csv/assets/js/docsearch.min.js?v=9db7c9eaa8e736ce16840e5bbc02047b"></script><script>docsearch({
                        apiKey: '2e185d125fc3636674585c446905cd8e',
                        indexName: 'donrichards_migrate_islandora_csv',
                        inputSelector: '#docsearch-input',
                        debug: false
                });</script><script defer="defer" src="https://donrichards.github.io/migrate_islandora_csv/assets/js/quicklink.umd.js?v=61daff262ce6be0813e6b1b0341274d4"></script><script>window.addEventListener('load', () =>{
         quicklink();
      });</script></body></html>